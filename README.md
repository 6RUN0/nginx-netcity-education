# Конфигурация nginx для приложения "Сетевой Город. Образование.".

Nginx выступает в качестве фронтэнда. В качестве бэкенда используется IIS. При такой конфигурации невозможна поддержка ntlm авторизации приложением (а оно нам надо?). Зато значительно снижается нагрузка на IIS, и на систему в целом.

Нагрузка на бэкенд (IIS)

| День          |Количество визитов|Страницы| Хиты | Объем   |
|:-------------:|:----------------:|:------:|:----:|:-------:|
|01 Октябрь 2013| 316              | 16,718 |16,718|110.33 МБ|
|02 Октябрь 2013| 320              | 26,049 |26,049|143.46 МБ|
|03 Октябрь 2013| 337              | 22,727 |22,752|136.35 МБ|
|04 Октябрь 2013| 252              | 13,735 |13,735|77.02 МБ |
|05 Октябрь 2013| 184              | 9,669  |9,697 |59.88 МБ |
|06 Октябрь 2013| 143              | 5,510  |5,523 |31.63 МБ |
|07 Октябрь 2013| 211              | 20,837 |20,837|139.05 МБ|
|08 Октябрь 2013| 245              | 34,356 |34,418|221.04 МБ|
|09 Октябрь 2013| 170              | 24,829 |24,887|177.80 МБ|

Нагрузка на фронтэнд (Nginx)

| День          |Количество визитов|Страницы| Хиты  | Объем   |
|:-------------:|:----------------:|:------:|:-----:|:-------:|
|01 Октябрь 2013| 324              | 18,268 |57,494 |342.25 МБ|
|02 Октябрь 2013| 328              | 28,041 |81,266 |433.76 МБ|
|03 Октябрь 2013| 349              | 24,285 |65,001 |372.89 МБ|
|04 Октябрь 2013| 258              | 14,081 |43,420 |259.89 МБ|
|05 Октябрь 2013| 196              | 10,264 |28,600 |224.96 МБ|
|06 Октябрь 2013| 146              | 5,937  |19,544 |151.80 МБ|
|07 Октябрь 2013| 210              | 22,163 |141,822|682.14 МБ|
|08 Октябрь 2013| 253              | 37,355 |117,503|647.44 МБ|
|09 Октябрь 2013| 184              | 26,121 |95,764 |463.55 МБ|

Показания получены посредством анализа логов IIS и nginx [awstat'ом](http://awstats.sourceforge.net/)

## Настройка IIS

Повесить IIS на 127.0.0.1 и сменить порт с 80 на 8080 или любой другой, не занятый порт. Указать в файле [upstreams.conf](upstreams.conf) значения привязки IIS.

## Настройка приложения "Сетевой город. Образование."

В файле ``C:/Program Files/NetCity2/Web/global.asa`` изменить ``Application("SERVER_HOSTNAME") = "127.0.0.1:8080"`` в соответсвии с [upstreams.conf](upstreams.conf)

В директории ``C:/Program Files/NetCity2/Web/`` создать файл ``robots.txt`` с содержимым
```
User-agent: *
Disallow: /
```
чтоб лишний раз поисковые роботы не беспокоили.

## SSL сертификат

Подписанный ssl сертификат, сроком действия один год можно взять на [startssl.com](http://www.startssl.com/)

## Ссылки

* [Описание приложения "Сетевой Город. Образование."](http://www.net-school.ru/netcity.php)
* [Документация nginx](http://nginx.org/ru/docs/)
* Заимствованы идеи и куски кода c https://github.com/perusio/drupal-with-nginx и http://wiki.nginx.org/Drupal
* [Как сгенерировать ssl сертификат с помощью openssl](https://www.google.com/search?q=how+to+create+ssl+certificate+with+openssl)
